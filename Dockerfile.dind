FROM docker:24-dind

# Install docker-compose and curl
RUN apk add --no-cache docker-compose curl

# Create working directory
WORKDIR /app

# Copy all necessary files
COPY docker-compose.dind.yml /app/
COPY nginx/ /app/nginx/
COPY dind-internal-start.sh /app/
COPY backend/ /app/backend/
COPY frontend/ /app/frontend/

# Make startup script executable
RUN chmod +x /app/start.sh

EXPOSE 80

CMD ["/app/dind-internal-start.sh"]
